@echo off
set PGPASSWORD=TPXP0stgres!!

echo ========================================
echo CHECKING FOR MISSING FIELDS IN ALL TABLES
echo ========================================
echo.

echo EVENTS TABLE - Checking for missing fields:
echo --------------------------------------------
"C:\Program Files\PostgreSQL\16\bin\psql.exe" -U postgres -d tpedb -t -c "SELECT 'event_type' as field, CASE WHEN EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='events' AND column_name='event_type') THEN 'EXISTS' ELSE 'MISSING' END as status UNION ALL SELECT 'price_range', CASE WHEN EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='events' AND column_name='price_range') THEN 'EXISTS' ELSE 'MISSING' END UNION ALL SELECT 'organizer_phone', CASE WHEN EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='events' AND column_name='organizer_phone') THEN 'EXISTS' ELSE 'MISSING' END UNION ALL SELECT 'organizer_company', CASE WHEN EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='events' AND column_name='organizer_company') THEN 'EXISTS' ELSE 'MISSING' END UNION ALL SELECT 'duration', CASE WHEN EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='events' AND column_name='duration') THEN 'EXISTS' ELSE 'MISSING' END UNION ALL SELECT 'topics', CASE WHEN EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='events' AND column_name='topics') THEN 'EXISTS' ELSE 'MISSING' END UNION ALL SELECT 'registration_url', CASE WHEN EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='events' AND column_name='registration_url') THEN 'EXISTS' ELSE 'MISSING' END UNION ALL SELECT 'success_metrics', CASE WHEN EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='events' AND column_name='success_metrics') THEN 'EXISTS' ELSE 'MISSING' END UNION ALL SELECT 'networking_quality_score', CASE WHEN EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='events' AND column_name='networking_quality_score') THEN 'EXISTS' ELSE 'MISSING' END;"

echo.
echo BOOKS TABLE - Checking for potentially missing fields:
echo --------------------------------------------
"C:\Program Files\PostgreSQL\16\bin\psql.exe" -U postgres -d tpedb -t -c "SELECT 'sample_chapter_link' as field, CASE WHEN EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='books' AND column_name='sample_chapter_link') THEN 'EXISTS' ELSE 'MISSING' END as status UNION ALL SELECT 'table_of_contents', CASE WHEN EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='books' AND column_name='table_of_contents') THEN 'EXISTS' ELSE 'MISSING' END UNION ALL SELECT 'submission_type', CASE WHEN EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='books' AND column_name='submission_type') THEN 'EXISTS' ELSE 'MISSING' END;"

echo.
echo PODCASTS TABLE - Checking for potentially missing fields:
echo --------------------------------------------
"C:\Program Files\PostgreSQL\16\bin\psql.exe" -U postgres -d tpedb -t -c "SELECT 'episode_count' as field, CASE WHEN EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='podcasts' AND column_name='episode_count') THEN 'EXISTS' ELSE 'MISSING' END as status UNION ALL SELECT 'average_episode_length', CASE WHEN EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='podcasts' AND column_name='average_episode_length') THEN 'EXISTS' ELSE 'MISSING' END UNION ALL SELECT 'format', CASE WHEN EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='podcasts' AND column_name='format') THEN 'EXISTS' ELSE 'MISSING' END UNION ALL SELECT 'host_linkedin', CASE WHEN EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='podcasts' AND column_name='host_linkedin') THEN 'EXISTS' ELSE 'MISSING' END UNION ALL SELECT 'host_company', CASE WHEN EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='podcasts' AND column_name='host_company') THEN 'EXISTS' ELSE 'MISSING' END UNION ALL SELECT 'host_bio', CASE WHEN EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='podcasts' AND column_name='host_bio') THEN 'EXISTS' ELSE 'MISSING' END UNION ALL SELECT 'spotify_url', CASE WHEN EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='podcasts' AND column_name='spotify_url') THEN 'EXISTS' ELSE 'MISSING' END UNION ALL SELECT 'apple_podcasts_url', CASE WHEN EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='podcasts' AND column_name='apple_podcasts_url') THEN 'EXISTS' ELSE 'MISSING' END UNION ALL SELECT 'youtube_url', CASE WHEN EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='podcasts' AND column_name='youtube_url') THEN 'EXISTS' ELSE 'MISSING' END UNION ALL SELECT 'other_platform_urls', CASE WHEN EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='podcasts' AND column_name='other_platform_urls') THEN 'EXISTS' ELSE 'MISSING' END UNION ALL SELECT 'accepts_guest_requests', CASE WHEN EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='podcasts' AND column_name='accepts_guest_requests') THEN 'EXISTS' ELSE 'MISSING' END UNION ALL SELECT 'guest_requirements', CASE WHEN EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='podcasts' AND column_name='guest_requirements') THEN 'EXISTS' ELSE 'MISSING' END UNION ALL SELECT 'typical_guest_profile', CASE WHEN EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='podcasts' AND column_name='typical_guest_profile') THEN 'EXISTS' ELSE 'MISSING' END UNION ALL SELECT 'booking_link', CASE WHEN EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='podcasts' AND column_name='booking_link') THEN 'EXISTS' ELSE 'MISSING' END UNION ALL SELECT 'subscriber_count', CASE WHEN EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='podcasts' AND column_name='subscriber_count') THEN 'EXISTS' ELSE 'MISSING' END UNION ALL SELECT 'download_average', CASE WHEN EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='podcasts' AND column_name='download_average') THEN 'EXISTS' ELSE 'MISSING' END;"